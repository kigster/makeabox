#!/usr/bin/env bash
# vim: ft=bash
# https://blog.phusion.nl/2017/10/13/why-ruby-app-servers-break-on-macos-high-sierra-and-what-can-be-done-about-it/

export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES
export RAILS_ENV="${RAILS_ENV:-"development"}"

mkdir -p tmp/pids

puma.boot() {
  set -ex 
  bundle exec puma -e "${RAILS_ENV}" -C $(pwd)/config/puma.rb --redirect-append "$@" &
  set +x
}

puma.boot "$@"
